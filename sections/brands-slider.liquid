{% comment %}
  Brands Slider Section with Swiper
{% endcomment %}

<div class="brands-slider">
  {% if section.blocks.size > 0 %}
    <div class="swiper-container">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          <div class="swiper-slide">
            <a href="/collections/{{ block.settings.brand_collection | handleize }}" aria-label="{{ block.settings.brand_collection }}">
              <img src="{{ block.settings.brand_image | img_url: 'medium' }}" alt="{{ block.settings.brand_collection }}">
              <div class="brand-overlay">
                <span>{{ block.settings.brand_collection }}</span>
              </div>
            </a>
          </div>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <p>No brands to show.</p>
  {% endif %}
</div>

{% schema %}
{
  "name": "Brands Slider",
  "settings": [
    {
      "type": "range",
      "id": "desktop_items",
      "label": "Items on Desktop",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "tablet_items",
      "label": "Items on Tablet",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "mobile_items",
      "label": "Items on Mobile",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 2
    }
  ],
  "blocks": [
    {
      "type": "brand",
      "name": "Brand",
      "settings": [
        {
          "type": "image_picker",
          "id": "brand_image",
          "label": "Brand Image"
        },
        {
          "type": "text",
          "id": "brand_collection",
          "label": "Brand Collection Name",
          "default": "Default Brand"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Brands Slider",
      "category": "Custom",
      "blocks": [
        {
          "type": "brand"
        },
        {
          "type": "brand"
        },
        {
          "type": "brand"
        },
        {
          "type": "brand"
        }
      ]
    }
  ]
}
{% endschema %}


{% style %}
  .swiper {
    width: 600px;
    height: 300px;
  }
{% endstyle %}

{% comment %}
  Initialize Swiper with responsive settings based on input range
{% endcomment %}

<script type="module">
   import Swiper from 'https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.mjs'

   document.addEventListener('DOMContentLoaded', () => {

        //Brand Items Variable
        const collectionTitle = document.querySelector('.collection-title');
        const productGrid = document.querySelector('.product-grid');

        const swiper = new Swiper('.swiper-container', {
          slidesPerView: '{{ section.settings.desktop_items }}',
          spaceBetween: 10,
          breakpoints: {
            1024: {
              slidesPerView: '{{ section.settings.tablet_items }}',
            },
            768: {
              slidesPerView: '{{ section.settings.mobile_items }}',
            }
          },
          loop: true,
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
          pagination: {
            el: '.swiper-pagination',
            clickable: true
          }
        });

        brandItems.forEach(item => {
            item.addEventListener('click', async () => {
                const brand = item.getAttribute('data-brand');
                collectionTitle.textContent = `Shop ${brand}`;
                productGrid.innerHTML = '<p>Loading...</p>';

                const response = await fetch(`/collections/${brand.toLowerCase()}/products.json`);
                const { products } = await response.json();

                productGrid.innerHTML = products.map(product => `
                <div class="product-item">
                    <a href="${product.url}">
                    <img src="${product.featured_image}" alt="${product.title}">
                    <h2>${product.title}</h2>
                    <p>${product.price | money}</p>
                    </a>
                </div>
                `).join('');
            });
         });

    });
</script>